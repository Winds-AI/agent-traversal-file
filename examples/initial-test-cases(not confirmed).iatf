:::IATF/1.0
@title: IATF Format Test Cases
@modified: 2026-01-26

===INDEX===
<!-- AUTO-GENERATED - DO NOT EDIT MANUALLY -->
<!-- Generated: 2026-01-26T15:55:53Z -->
<!-- Content-Hash: sha256:4da6c7a -->

# Overview {#overview | lines:138-155 | words:61}
> Purpose and scope of the test suite.
  Created: 2026-01-26 | Modified: 2026-01-26
  Hash: 44d98cb

# Test Case Format {#test-case-format | lines:157-173 | words:54}
> Standard structure for test cases in this document.
  Created: 2026-01-26 | Modified: 2026-01-26
  Hash: 909e8f0

# Header Tests {#header-tests | lines:175-198 | words:89}
> Header declaration and metadata validation.
  Created: 2026-01-26 | Modified: 2026-01-26
  Hash: d3579f9

# Index Delimiter Tests {#index-delimiter-tests | lines:200-228 | words:118}
> INDEX section delimiter and auto-generated markers.
  Created: 2026-01-26 | Modified: 2026-01-26
  Hash: 6e13f6d

# Index Entry Tests {#index-entry-tests | lines:230-258 | words:121}
> Index entry syntax, hierarchy, and metadata.
  Created: 2026-01-26 | Modified: 2026-01-26
  Hash: a60f056

# Hierarchy Tests {#hierarchy-tests | lines:260-278 | words:80}
> Hierarchy rules and nesting limits.
  Created: 2026-01-26 | Modified: 2026-01-26
  Hash: b8aba31

# Content Delimiter Tests {#content-delimiter-tests | lines:280-298 | words:70}
> CONTENT delimiter and placement validation.
  Created: 2026-01-26 | Modified: 2026-01-26
  Hash: 53d368a

# Content Block Tests {#content-block-tests | lines:300-323 | words:101}
> Content block rules and nesting behavior.
  Created: 2026-01-26 | Modified: 2026-01-26
  Hash: 85d0f7a

# Metadata Annotation Tests {#annotation-tests | lines:325-338 | words:53}
> Summary and tags extraction into INDEX.
  Created: 2026-01-26 | Modified: 2026-01-26
  Hash: 74e056d

# Modification Tracking Tests {#modification-tracking-tests | lines:340-358 | words:71}
> Hashing and Modified date behavior.
  Created: 2026-01-26 | Modified: 2026-01-26
  Hash: c098a85

# Line Numbering Tests {#line-number-tests | lines:360-378 | words:72}
> Absolute line numbering rules.
  Created: 2026-01-26 | Modified: 2026-01-26
  Hash: c1ea358

# Identifier Tests {#id-format-tests | lines:380-398 | words:59}
> ID format and uniqueness rules.
  Created: 2026-01-26 | Modified: 2026-01-26
  Hash: 31331f1

# Escaping Tests {#escaping-tests | lines:400-413 | words:51}
> Escaping rules and current limitations.
  Created: 2026-01-26 | Modified: 2026-01-26
  Hash: 89ee23d

# Whitespace Tests {#whitespace-tests | lines:415-428 | words:45}
> Whitespace rules and formatting behavior.
  Created: 2026-01-26 | Modified: 2026-01-26
  Hash: 446f735

# Encoding Tests {#encoding-tests | lines:430-443 | words:39}
> UTF-8 and line endings.
  Created: 2026-01-26 | Modified: 2026-01-26
  Hash: a7fed7d

# Extension and MIME Tests {#extension-mime-tests | lines:445-458 | words:46}
> File extension and MIME type guidance.
  Created: 2026-01-26 | Modified: 2026-01-26
  Hash: db56b94

# Validation Level Tests {#validation-level-tests | lines:460-483 | words:89}
> Validation level behaviors.
  Created: 2026-01-26 | Modified: 2026-01-26
  Hash: 040cd2b

# Index Staleness Tests {#staleness-tests | lines:485-498 | words:45}
> Index staleness detection and warnings.
  Created: 2026-01-26 | Modified: 2026-01-26
  Hash: cf02b66

# Minimal File Tests {#minimal-file-tests | lines:500-513 | words:48}
> Minimal file examples and rebuild behavior.
  Created: 2026-01-26 | Modified: 2026-01-26
  Hash: 73fe6be

# Section Reference Tests {#reference-tests | lines:515-543 | words:122}
> Cross-reference syntax and validation.
  Created: 2026-01-26 | Modified: 2026-01-26
  Hash: dd6201f

# Graph Command Tests {#graph-command-tests | lines:545-573 | words:120}
> Graph command behavior and error cases.
  Created: 2026-01-26 | Modified: 2026-01-26
  Hash: 1e3b236

# Index Command Tests {#index-command-tests | lines:575-588 | words:47}
> Index command output behavior.
  Created: 2026-01-26 | Modified: 2026-01-26
  Hash: ec6b7c5

# Rebuild Command Tests {#rebuild-command-tests | lines:590-603 | words:49}
> Rebuild command behavior.
  Created: 2026-01-26 | Modified: 2026-01-26
  Hash: c2eb808

# Validate Command Tests {#validate-command-tests | lines:605-618 | words:44}
> Validate command behavior.
  Created: 2026-01-26 | Modified: 2026-01-26
  Hash: ade01dc

# Watch Command Tests {#watch-command-tests | lines:620-633 | words:44}
> Watch and unwatch behavior.
  Created: 2026-01-26 | Modified: 2026-01-26
  Hash: d68ac92


===CONTENT===

{#overview}
@summary: Purpose and scope of the test suite.
# Overview

This file defines format and CLI test cases for IATF v1.0.
It is a human-readable checklist intended for both implementations.

Scope:
- File structure and section delimiters
- Index generation and validation
- Content blocks and metadata
- References and graph output
- CLI commands (rebuild, validate, index, graph)

Out of scope:
- Installer behavior
- Editor plugin specifics
{/overview}

{#test-case-format}
@summary: Standard structure for test cases in this document.
# Test Case Format

Each test uses the following fields:

- ID: Unique short identifier
- Purpose: What the test verifies
- Steps: Minimal steps to execute
- Expected: Observable result

Example:
- ID: HEADER-01
- Purpose: Validate header format declaration
- Steps: Open file, verify first line
- Expected: First line matches :::IATF/1.0
{/test-case-format}

{#header-tests}
@summary: Header declaration and metadata validation.
# Header Tests

- ID: HEADER-01
  Purpose: File starts with format declaration
  Steps: Open file, read line 1
  Expected: Line 1 is exactly :::IATF/1.0

- ID: HEADER-02
  Purpose: Reject missing format declaration
  Steps: Remove first line, run `iatf validate`
  Expected: Validation fails with missing declaration error

- ID: HEADER-03
  Purpose: Accept optional metadata fields
  Steps: Add @title and @modified in header
  Expected: Validation passes and metadata preserved on rebuild

- ID: HEADER-04
  Purpose: Accept custom metadata fields
  Steps: Add @owner: Team A
  Expected: Validation passes and field is preserved
{/header-tests}

{#index-delimiter-tests}
@summary: INDEX section delimiter and auto-generated markers.
# Index Delimiter Tests

- ID: INDEX-01
  Purpose: Require exactly one INDEX section
  Steps: Duplicate ===INDEX=== delimiter, run `iatf validate`
  Expected: Validation fails for multiple INDEX sections

- ID: INDEX-02
  Purpose: INDEX must precede CONTENT
  Steps: Move ===CONTENT=== above ===INDEX===
  Expected: Validation fails for incorrect section order

- ID: INDEX-03
  Purpose: Auto-generated marker is required
  Steps: Remove <!-- AUTO-GENERATED - DO NOT EDIT MANUALLY -->
  Expected: Validation fails for missing auto-generated marker

- ID: INDEX-04
  Purpose: Generated timestamp format is ISO 8601 UTC
  Steps: Replace timestamp with non-ISO value
  Expected: Validation fails or warning for invalid timestamp

- ID: INDEX-05
  Purpose: Content hash is present after rebuild
  Steps: Run `iatf rebuild`
  Expected: INDEX includes <!-- Content-Hash: ... -->
{/index-delimiter-tests}

{#index-entry-tests}
@summary: Index entry syntax, hierarchy, and metadata.
# Index Entry Tests

- ID: ENTRY-01
  Purpose: Each entry has level marker, title, and metadata block
  Steps: Remove metadata block from one entry
  Expected: Validation fails for malformed entry

- ID: ENTRY-02
  Purpose: IDs are unique across INDEX
  Steps: Duplicate an ID in two entries
  Expected: Validation fails for duplicate ID

- ID: ENTRY-03
  Purpose: Line ranges are present and valid
  Steps: Remove lines:start-end or swap start/end
  Expected: Validation fails for invalid line ranges

- ID: ENTRY-04
  Purpose: Word counts are present and numeric
  Steps: Replace words:123 with words:abc
  Expected: Validation fails for invalid word count

- ID: ENTRY-05
  Purpose: Summary lines are optional and indented
  Steps: Add summary without leading >
  Expected: Summary is ignored or flagged as invalid
{/index-entry-tests}

{#hierarchy-tests}
@summary: Hierarchy rules and nesting limits.
# Hierarchy Tests

- ID: HIER-01
  Purpose: Parent line range contains child range
  Steps: Manually edit index so child range exceeds parent
  Expected: Validation fails for invalid hierarchy range

- ID: HIER-02
  Purpose: Skipping levels is allowed
  Steps: Create # followed by ### entry, rebuild
  Expected: Validation passes and hierarchy remains valid

- ID: HIER-03
  Purpose: Enforce max nesting depth of 2 in this project
  Steps: Create 3-level nested blocks, run `iatf rebuild`
  Expected: Rebuild fails or reports depth violation
{/hierarchy-tests}

{#content-delimiter-tests}
@summary: CONTENT delimiter and placement validation.
# Content Delimiter Tests

- ID: CONTENT-01
  Purpose: Require exactly one CONTENT section
  Steps: Add a second ===CONTENT=== delimiter
  Expected: Validation fails for multiple CONTENT sections

- ID: CONTENT-02
  Purpose: CONTENT must appear after INDEX
  Steps: Place CONTENT before INDEX
  Expected: Validation fails for incorrect section order

- ID: CONTENT-03
  Purpose: Hand-written file can omit INDEX
  Steps: Remove entire INDEX section, run `iatf rebuild`
  Expected: Rebuild generates INDEX and succeeds
{/content-delimiter-tests}

{#content-block-tests}
@summary: Content block rules and nesting behavior.
# Content Block Tests

- ID: BLOCK-01
  Purpose: Every block has matching open and close tags
  Steps: Remove closing tag for one block
  Expected: Validation fails for unmatched tag

- ID: BLOCK-02
  Purpose: All content is inside blocks
  Steps: Add text outside any block, run `iatf validate`
  Expected: Validation fails for content outside blocks

- ID: BLOCK-03
  Purpose: Block IDs match index IDs
  Steps: Change a block ID without updating index
  Expected: Validation fails for missing ID in INDEX

- ID: BLOCK-04
  Purpose: Nested blocks are allowed
  Steps: Nest a child block inside a parent
  Expected: Rebuild succeeds and reflects hierarchy
{/content-block-tests}

{#annotation-tests}
@summary: Summary and tags extraction into INDEX.
# Metadata Annotation Tests

- ID: META-01
  Purpose: @summary appears in INDEX as summary
  Steps: Add @summary to a block, run rebuild
  Expected: INDEX entry includes summary lines

- ID: META-02
  Purpose: @tags does not affect INDEX entries
  Steps: Add @tags to a block, run rebuild
  Expected: INDEX remains unchanged except for hash/lines/words
{/annotation-tests}

{#modification-tracking-tests}
@summary: Hashing and Modified date behavior.
# Modification Tracking Tests

- ID: MOD-01
  Purpose: Modified date updates when content changes
  Steps: Change content inside a block, run rebuild
  Expected: INDEX entry Modified date updates to 2026-01-26 (or today)

- ID: MOD-02
  Purpose: Created date is preserved
  Steps: Edit content, run rebuild
  Expected: Created date remains unchanged

- ID: MOD-03
  Purpose: Hash updates on content change
  Steps: Change content, run rebuild
  Expected: Hash value changes in INDEX entry
{/modification-tracking-tests}

{#line-number-tests}
@summary: Absolute line numbering rules.
# Line Numbering Tests

- ID: LINE-01
  Purpose: Line numbers are absolute file line numbers
  Steps: Rebuild and compare line numbers to file line count
  Expected: lines:start-end match file line positions

- ID: LINE-02
  Purpose: Blank lines are counted
  Steps: Add blank lines inside a block, rebuild
  Expected: lines:start-end increase accordingly

- ID: LINE-03
  Purpose: Ranges include opening and closing tags
  Steps: Rebuild, check range
  Expected: Range includes {#id} and {/id} lines
{/line-number-tests}

{#id-format-tests}
@summary: ID format and uniqueness rules.
# Identifier Tests

- ID: ID-01
  Purpose: IDs must start with a letter
  Steps: Use {#1bad}, rebuild
  Expected: Validation fails for invalid ID

- ID: ID-02
  Purpose: IDs may include letters, numbers, hyphens, underscores
  Steps: Use {#api_v2-setup}
  Expected: Validation passes

- ID: ID-03
  Purpose: IDs are case-sensitive
  Steps: Use {#Intro} and {#intro}
  Expected: Validation passes, treated as different IDs
{/id-format-tests}

{#escaping-tests}
@summary: Escaping rules and current limitations.
# Escaping Tests

- ID: ESC-01
  Purpose: IATF markers in content are not supported
  Steps: Add literal {#id} in prose
  Expected: Validation fails or content is misparsed (document limitation)

- ID: ESC-02
  Purpose: Document workaround in code blocks
  Steps: Place {#id} inside fenced code block
  Expected: Validation passes and content preserved
{/escaping-tests}

{#whitespace-tests}
@summary: Whitespace rules and formatting behavior.
# Whitespace Tests

- ID: WS-01
  Purpose: Trailing whitespace is insignificant
  Steps: Add trailing spaces to content lines
  Expected: Rebuild does not change semantics

- ID: WS-02
  Purpose: Index entries are single-line
  Steps: Insert newline in index entry line
  Expected: Validation fails for malformed entry
{/whitespace-tests}

{#encoding-tests}
@summary: UTF-8 and line endings.
# Encoding Tests

- ID: ENC-01
  Purpose: UTF-8 encoding required
  Steps: Save file as non-UTF-8, run validate
  Expected: Validation fails or warns

- ID: ENC-02
  Purpose: LF preferred, CRLF accepted
  Steps: Save with CRLF, run rebuild
  Expected: Rebuild succeeds
{/encoding-tests}

{#extension-mime-tests}
@summary: File extension and MIME type guidance.
# Extension and MIME Tests

- ID: EXT-01
  Purpose: .iatf extension is recommended but not required
  Steps: Rename file to .txt, run rebuild
  Expected: Rebuild succeeds

- ID: MIME-01
  Purpose: MIME type suggestions are informational
  Steps: Serve file as text/iatf
  Expected: No behavioral changes in CLI
{/extension-mime-tests}

{#validation-level-tests}
@summary: Validation level behaviors.
# Validation Level Tests

- ID: VAL-01
  Purpose: Level 1 checks structure
  Steps: Remove CONTENT delimiter, run validate
  Expected: Fails structure validation

- ID: VAL-02
  Purpose: Level 2 checks ID consistency
  Steps: Add index entry without content block
  Expected: Fails consistency validation

- ID: VAL-03
  Purpose: Level 3 checks line and word accuracy
  Steps: Tamper with line numbers, run validate
  Expected: Fails accuracy validation

- ID: VAL-04
  Purpose: Level 4 checks content hash freshness
  Steps: Edit content without rebuild, run validate
  Expected: Warns or fails for stale INDEX hash
{/validation-level-tests}

{#staleness-tests}
@summary: Index staleness detection and warnings.
# Index Staleness Tests

- ID: STALE-01
  Purpose: Content hash mismatch triggers warning
  Steps: Edit content, skip rebuild, run validate
  Expected: Warning that INDEX is stale

- ID: STALE-02
  Purpose: Rebuild resolves staleness
  Steps: Run `iatf rebuild` after change
  Expected: Warning disappears and hash matches
{/staleness-tests}

{#minimal-file-tests}
@summary: Minimal file examples and rebuild behavior.
# Minimal File Tests

- ID: MIN-01
  Purpose: Hand-written minimal file without INDEX is valid input
  Steps: Create file with only header and CONTENT
  Expected: `iatf rebuild` generates INDEX

- ID: MIN-02
  Purpose: Auto-indexed minimal file is valid
  Steps: Rebuild minimal file
  Expected: Validate passes for rebuilt file
{/minimal-file-tests}

{#reference-tests}
@summary: Cross-reference syntax and validation.
# Section Reference Tests

- ID: REF-01
  Purpose: Reference syntax { @section-id} is recognized
  Steps: Add { @overview} to a section
  Expected: Rebuild succeeds if target exists

- ID: REF-02
  Purpose: Self-reference is an error
  Steps: Add { @reference-tests} inside the same section
  Expected: Rebuild fails with self-reference error

- ID: REF-03
  Purpose: Missing target reference is an error
  Steps: Add { @missing} to content
  Expected: Rebuild fails with missing target error

- ID: REF-04
  Purpose: References in fenced code blocks are ignored
  Steps: Add { @missing} inside fenced code block
  Expected: Rebuild succeeds; no reference error

- ID: REF-05
  Purpose: Circular references are allowed
  Steps: Create A -> B and B -> A references
  Expected: Rebuild succeeds with no circular error
{/reference-tests}

{#graph-command-tests}
@summary: Graph command behavior and error cases.
# Graph Command Tests

- ID: GRAPH-01
  Purpose: Graph requires INDEX section
  Steps: Remove INDEX, run `iatf graph file.iatf`
  Expected: Command fails with non-zero exit code

- ID: GRAPH-02
  Purpose: Graph requires CONTENT section
  Steps: Remove CONTENT, run `iatf graph file.iatf`
  Expected: Command fails with non-zero exit code

- ID: GRAPH-03
  Purpose: Graph fails if no sections exist
  Steps: Remove all blocks, run `iatf graph file.iatf`
  Expected: Command fails with non-zero exit code

- ID: GRAPH-04
  Purpose: Graph output uses outgoing references by default
  Steps: Add references, run `iatf graph file.iatf`
  Expected: Output shows id -> target1, target2

- ID: GRAPH-05
  Purpose: Graph output with incoming references
  Steps: Run `iatf graph --show-incoming file.iatf`
  Expected: Output shows id <- source1, source2
{/graph-command-tests}

{#index-command-tests}
@summary: Index command output behavior.
# Index Command Tests

- ID: INDEXCMD-01
  Purpose: `iatf index` outputs only INDEX section
  Steps: Run `iatf index file.iatf`
  Expected: Output contains INDEX section only

- ID: INDEXCMD-02
  Purpose: INDEX command does not modify file
  Steps: Run `iatf index`, then check file timestamp
  Expected: File is unchanged
{/index-command-tests}

{#rebuild-command-tests}
@summary: Rebuild command behavior.
# Rebuild Command Tests

- ID: REBUILD-01
  Purpose: Rebuild inserts INDEX when missing
  Steps: Remove INDEX, run `iatf rebuild file.iatf`
  Expected: INDEX is inserted with entries

- ID: REBUILD-02
  Purpose: Rebuild updates line numbers and word counts
  Steps: Edit content, run rebuild
  Expected: INDEX reflects new lines and words
{/rebuild-command-tests}

{#validate-command-tests}
@summary: Validate command behavior.
# Validate Command Tests

- ID: VALIDATE-01
  Purpose: Validate reports structural errors
  Steps: Remove CONTENT delimiter, run validate
  Expected: Validation fails with structure error

- ID: VALIDATE-02
  Purpose: Validate reports reference errors
  Steps: Add invalid reference, run validate
  Expected: Validation output lists reference errors
{/validate-command-tests}

{#watch-command-tests}
@summary: Watch and unwatch behavior.
# Watch Command Tests

- ID: WATCH-01
  Purpose: Watch rebuilds index on save
  Steps: Run `iatf watch file.iatf`, edit content, save
  Expected: Index rebuilds automatically

- ID: WATCH-02
  Purpose: Unwatch stops auto-rebuild
  Steps: Run `iatf unwatch file.iatf`, edit content
  Expected: Index does not rebuild
{/watch-command-tests}
